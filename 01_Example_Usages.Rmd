---
title: "R Notebook"
output: html_notebook
---

## Setup

```{r setup}
source("R/build_causal_matrix.R")
source("R/build_formula_matrix.R")
source("R/keep_minimal.R")
```

## Build causal matrix

The object 'inputs' takes the form of a named list. 

In the 'inputs list:

1. Nodes can be given any alpha-numeric naming convention, but for plotting and comparison will be transformed into X1-Xn based on the timing.

2. Timing requires entering integers from 0 backwards. Zero should be given to the outcome (otc) variable and all other independent variables need to be chronologically ordered. Not real time, but ordinal timing of events. It is possible for variables to occur simultaneously, even if this is just observationally)

3. Types include "test", "otc", or "ctr". 
    a. "ctr" is a control or adjustment variable that is not the test variable in question
    b. "test" is the test variable in question, treatment for example.
    c. "otc" is the outcome, dependent variable.


```{r causal_matrix}

inputs <- list(nodes=c("a","b","c","d","e"), timing=c(0,-1,-2,-3,-3),
              types=c("otc","test","ctr","ctr","ctr"))

causal_matrix <- build_causal_matrix(inputs)
```


## Build formula_matrix
```{r formula_matrix}

formula_matrix <- build_formula_matrix(causal_matrix)
```

## Remove Xs which do not belong to the MAS from each model and remove duplicated models deriving from this action

```{r keep_minimal}
reduced_causal_matrix <- keep_minimal(formula_matrix, causal_matrix)
reduced_formula_matrix <- build_formula_matrix(reduced_causal_matrix)

```

## Visualizations

```{r viz}
additional_args <- list(
    exposure="Xtest",
    outcome="Y"
)
formulas_vector <- strsplit(unlist(reduced_formula_matrix[67,1]), ",")[[1]]
dag <- do.call(dagify, c(lapply(formulas_vector, as.formula), additional_args))


formulas_vector <- strsplit(unlist(reduced_formula_matrix[12,1]), ",")[[1]]
dag2 <- do.call(dagify, c(lapply(formulas_vector, as.formula), additional_args))

```

```{r graph_1}
plot(graphLayout(dag))
```

```{r graph_2}
plot(graphLayout(dag2))
```

